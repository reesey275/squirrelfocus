name: Merge Log
on:
  push:
    branches: [main, development]
permissions:
  contents: write
jobs:
  append-log:
    runs-on: ubuntu-24.04
    timeout-minutes: 15
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Install PyYAML
        timeout-minutes: 15
        run: |
          python -m pip install --upgrade pip
          pip install "PyYAML>=6,<7"
      - name: Build log line
        timeout-minutes: 15
        run: |
          line="- $(date -u +%F) â€” $(python3 scripts/sqf_emit.py \
            trailers | tr '\n' '; ')"
          grep -Fxq "$line" MILESTONE_LOG.md || \
            echo "$line" >> MILESTONE_LOG.md
      - name: Commit log
        timeout-minutes: 15
        run: |
          git config user.name "github-actions"
          git config user.email "actions@users.noreply.github.com"
          git add MILESTONE_LOG.md
          git commit -m "chore: append milestone log" || echo "No changes"
          git push
